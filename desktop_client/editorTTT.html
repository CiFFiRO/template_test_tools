<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="external/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet" type="text/css">
  <link href="external/bootstrap-select.css" rel="stylesheet" type="text/css">
  <link href="external/codemirror/codemirror.css" rel="stylesheet" type="text/css">
  <link href="external/codemirror/darcula.css" rel="stylesheet" type="text/css">
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script type="text/javascript" src="external/jquery-3.3.1.js"></script>
  <script type="text/javascript" src="external/bootstrap-3.3.7/js/bootstrap.js"></script>
  <script type="text/javascript" src="external/bootstrap-select.js"></script>
  <script type="text/javascript" src="external/codemirror/codemirror.js"></script>
  <script type="text/javascript" src="external/codemirror/javascript.js"></script>
  <script type="text/javascript" src="external/codemirror/active-line.js"></script>
  <script type="text/javascript" src="external/codemirror/matchbrackets.js"></script>
  <script type="text/javascript" src="tools/editor/templateTestTaskInternal.js"></script>
  <script type="text/javascript" src="tools/editor/templateTestTaskView.js"></script>
  <script type="text/javascript" src="scripts/view/templateTestTaskViewDesktop.js"></script>
  <script type="text/javascript" src="scripts/common.js"></script>
  <script>if (window.module) module = window.module;</script>
  <script type="text/javascript">
    $(document).ready(function () {
      window.debugStatus = true;

      let templateTestViewWeb = new TemplateTestTaskDesktop();
      templateTestViewWeb.initialize('templateTestTaskEditor');

      const { remote } = require('electron');
      const { Menu, MenuItem, dialog, globalShortcut } = remote;
      let warningLoseChanges = () => {
        return dialog.showMessageBoxSync({
          type: 'warning',
          title: 'Предупреждение',
          message: 'Все не сохраненные изменения будут потеряны!',
          buttons: ['Отмена', 'Продолжить']
        });
      };
      let openAction = function () {
        if (warningLoseChanges() === 1) {
          templateTestViewWeb.loadTTT();
        }
      };
      let saveAction = function () {
        templateTestViewWeb.saveTTT();
      };
      let saveAsAction = function () {
        let fileName = dialog.showSaveDialogSync({
          filters: [
            { name: 'ШТЗ', extensions: ['json'] }
          ]
        });
        if (fileName === undefined) {
          return;
        }
        templateTestViewWeb.saveTTT(fileName);
      };

      globalShortcut.unregister('CommandOrControl+O');
      globalShortcut.unregister('CommandOrControl+S');
      globalShortcut.unregister('CommandOrControl+Shift+S');

      globalShortcut.register('CommandOrControl+O', openAction);
      globalShortcut.register('CommandOrControl+S', saveAction);
      globalShortcut.register('CommandOrControl+Shift+S', saveAsAction);

      const menu = new Menu();
      menu.append(new MenuItem({
        label: 'Загрузить...',
        accelerator: 'CmdOrCtrl+O',
        click: openAction
      }));
      menu.append(new MenuItem({
        label: 'Сохранить...',
        accelerator: 'CmdOrCtrl+S',
        click: saveAction
      }));
      menu.append(new MenuItem({
        label: 'Сохранить как...',
        accelerator: 'CmdOrCtrl+Shift+S',
        click: saveAsAction
      }));

      window.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        menu.popup({ window: remote.getCurrentWindow() });
      }, false);
    });
  </script>
  <style>
    .CodeMirror {border: 1px solid black; font-size:13px}
  </style>
</head>
<body>
<div class="container" id="templateTestTaskEditor">
</div>
</body>
</html>